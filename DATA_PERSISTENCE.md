# Решение проблемы с сохранением данных

## Проблема
После каждого перезапуска приложения все блоги и посты исчезали.

## Причина
Приложение пыталось подключиться к MongoDB, но она не была установлена на системе. В результате данные не сохранялись и "исчезали" после перезапуска.

## Решение
Добавлено **файловое хранилище** как альтернатива MongoDB. Теперь приложение:

1. **Автоматически определяет** доступность MongoDB
2. **Использует MongoDB** если она доступна
3. **Переключается на файловое хранилище** если MongoDB недоступна

## Как это работает

### Файловое хранилище
- Данные сохраняются в директории `data/`
- `data/blogs.json` - блоги
- `data/posts.json` - посты
- Автоматическое создание директории при первом запуске

### Гибридный подход
```javascript
// Приложение автоматически выбирает хранилище
if (useMongoDB) {
  // Использует MongoDB
  const blog = await Blog.findOne({ userId });
} else {
  // Использует файловое хранилище
  const blog = blogs.find(b => b.userId === userId);
}
```

## Установка MongoDB (опционально)

### Для macOS:
```bash
# Обновить Command Line Tools
sudo rm -rf /Library/Developer/CommandLineTools
sudo xcode-select --install

# Установить MongoDB
brew install mongodb-community

# Запустить MongoDB
brew services start mongodb-community
```

### Для других систем:
См. официальную документацию MongoDB: https://docs.mongodb.com/manual/installation/

## Преимущества решения

✅ **Немедленное решение** - работает без установки MongoDB  
✅ **Совместимость** - автоматически переключается на MongoDB при её наличии  
✅ **Надежность** - данные сохраняются между перезапусками  
✅ **Простота** - не требует дополнительной настройки  

## Структура данных

### Блог (blogs.json)
```json
{
  "id": "уникальный_id",
  "userId": 123456789,
  "name": "Название блога",
  "subdomain": "subdomain",
  "url": "https://subdomain.yourdomain.com",
  "createdAt": "2025-07-18T13:51:04.334Z",
  "updatedAt": "2025-07-18T13:51:04.334Z"
}
```

### Пост (posts.json)
```json
{
  "id": "уникальный_id",
  "blogId": "id_блога",
  "content": "Содержимое поста",
  "title": "Заголовок поста",
  "createdAt": "2025-07-18T13:51:04.334Z",
  "updatedAt": "2025-07-18T13:51:04.334Z",
  "viewCount": 0,
  "likes": 0,
  "isPublished": true
}
```

## Проверка работы

1. Запустите приложение: `node bot.js`
2. Создайте блог через Telegram бота
3. Создайте несколько постов
4. Остановите приложение (Ctrl+C)
5. Запустите снова: `node bot.js`
6. Проверьте, что блог и посты остались

Данные должны сохраниться в файлах `data/blogs.json` и `data/posts.json`. 